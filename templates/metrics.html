{% extends "base.html" %}

{% block main-content %}
    <div id="sessions_chart_container" style="width: 100%; height: 400px"></div>
{% end %}

{% block bottom-js %}
    <script type="text/javascript">
        var sessionsChart;

        $(document).ready(function() {
            sessionsChart = new Highcharts.Chart({
                chart: {
                    renderTo: 'sessions_chart_container',
                    type: 'line'
                },
                title: {
                    text: 'Sessions'
                },
//                xAxis: {
//                    categories: ['Apples', 'Bananas', 'Oranges']
//                },
                yAxis: {
                    title: {
                        text: 'Session Count'
                    }
                },
                series: [
                    {
                        name: 'Control Sessions',
                        data: []
                    },
                    {
                        name: 'Experiment Sessions',
                        data: []
                    },
                ]
            });
        });
    </script>

    <script type="text/javascript">
        var ws = new WebSocket("ws://localhost:{{ ui_port }}/d/metrics");
        ws.onopen = function() {
            // campaign id, maybe send as json?
            ws.send("12345");
        };
        ws.onmessage = function(evt) {
            //window.console.log(evt.data);

            d = $.parseJSON(evt.data);

            var controlGroupSeries = sessionsChart.series[0];
            var experimentGroupSeries = sessionsChart.series[1];

            var shift = ((controlGroupSeries.data.length > 20) || (experimentGroupSeries.data.length > 20));

            sessionsChart.series[0].addPoint(parseInt(d['control_group']), true, shift);
            sessionsChart.series[1].addPoint(parseInt(d['experiment_group']), true, shift);
        };
    </script>
{% end %}
